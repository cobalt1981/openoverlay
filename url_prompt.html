<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline';">
<title>TangiaOverlay URL</title>
<style>
  :root{
    --bg:#0b0f14;
    --card:#121820;
    --text:#e5e7eb;
    --muted:#94a3b8;
    --border:#233143;
    --btn:#1f2a37;
    --btn-hover:#263244;
    --btn-active:#30405a;
    --accent:#3b82f6;
    --shadow:0 8px 28px rgba(0,0,0,.45);
    --radius:4px;
    --radius-lg:8px;
  }
  @media (prefers-color-scheme: light){
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#475569;
      --border:#e5e7eb;
      --btn:#e5e7eb;
      --btn-hover:#e2e8f0;
      --btn-active:#dbe3ef;
      --accent:#2563eb;
      --shadow:0 6px 24px rgba(0,0,0,.08);
    }
  }
  html,body{height:100%}
  body{
    margin:0;
    display:grid;
    place-items:center;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
  }
  .card{
    width:560px;
    max-width:92vw;
    border:1px solid var(--border);
    border-radius:var(--radius-lg);
    padding:16px 16px 14px;
    background:var(--card);
    box-shadow:var(--shadow);
  }
  h1{
    margin:0 0 10px 0;
    font-size:18px;
    font-weight:700;
  }
  label{
    display:block;
    margin-bottom:8px;
    font-weight:600;
    color:var(--text);
  }
  input{
    width:100%;
    padding:12px 12px;
    box-sizing:border-box;
    border:1px solid var(--border);
    border-radius:var(--radius);
    font-size:14px;
    color:var(--text);
    background:transparent;
    outline:none;
    transition:border-color .15s ease, box-shadow .15s ease;
  }
  input:focus{
    border-color:var(--accent);
    box-shadow:0 0 0 3px rgba(59,130,246,.25);
  }
  .row{
    margin-top:14px;
    display:flex;
    gap:10px;
    justify-content:flex-end;
  }
  button{
    padding:10px 14px;
    border-radius:var(--radius);
    border:1px solid var(--border);
    background:var(--btn);
    font-size:14px;
    color:var(--text);
    cursor:pointer;
    transition:transform .04s ease, background .12s ease, box-shadow .12s ease;
    user-select:none;
  }
  button:hover{ background:var(--btn-hover) }
  button:active{
    background:var(--btn-active);
    transform:translateY(1px);
  }
  button:focus-visible{
    outline:2px solid var(--accent);
    outline-offset:2px;
  }
  .primary{
    border-color:rgba(59,130,246,.4);
  }
  .hint{
    margin-top:8px;
    font-size:12px;
    color:var(--muted);
  }
  .error{
    margin-top:8px;
    font-size:13px;
    color:#ef4444;
    display:none;
  }
  .error.show{ display:block }
</style>
</head>
<body>
  <div class="card">
    <h1>Overlay URL</h1>
    <label for="u">Enter the overlay URL</label>
    <input id="u" type="url" placeholder="https://example.com">
    <div class="error" id="err">Enter a valid URL.</div>
    <div class="row">
      <button id="cancel">Cancel</button>
      <button id="set" class="primary">Save</button>
    </div>
    <div class="hint">Press Enter to save â€¢ Esc to cancel</div>
  </div>
  <script>
    const q = new URLSearchParams(location.search);
    const current = q.get("current") || "";
    const u = document.getElementById("u");
    const err = document.getElementById("err");
    const btnSet = document.getElementById("set");
    const btnCancel = document.getElementById("cancel");

    function normalize(v){
      const x = v.trim();
      if (!x) return "";
      if (/^https?:\/\//i.test(x)) return x;
      if (/^[a-z0-9.-]+\.[a-z]{2,}($|[/:?])/i.test(x)) return "https://" + x;
      return x;
    }
    function isValidHttpUrl(v){
      try{
        const u = new URL(v);
        return /^https?:$/.test(u.protocol);
      }catch{ return false; }
    }
    async function onSave(){
      err.classList.remove("show");
      let val = normalize(u.value);
      if (!isValidHttpUrl(val)){
        err.textContent = "Enter a valid http(s) URL.";
        err.classList.add("show");
        return;
      }
      btnSet.disabled = true;
      btnCancel.disabled = true;
      const ok = await window.overlayAPI.setUrl(val);
      if (!ok){
        btnSet.disabled = false;
        btnCancel.disabled = false;
        err.textContent = "Could not save URL.";
        err.classList.add("show");
        return;
      }
      await window.overlayAPI.closeWindow();
    }

    u.value = current;
    u.focus();
    u.select();

    btnCancel.addEventListener("click", () => window.overlayAPI.closeWindow());
    btnSet.addEventListener("click", onSave);

    u.addEventListener("keydown", e => {
      if (e.key === "Enter") onSave();
      if (e.key === "Escape") window.overlayAPI.closeWindow();
    });
  </script>
</body>
</html>
